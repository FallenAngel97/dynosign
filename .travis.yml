language: node_js
node_js:
  - 11.6.0
cache: npm

before_install:
  - rvm install 2.6.0
  - rvm use 2.6.0
  - gem install bundler 
  #if gems are missing this script will get the missing gems.
  - cd gh-pages && bundle check || bundle install && jekyll build 
  - npm ci

script: 
  - npm test
  - npm run build
  - npm run dist

deploy:
  - provider: releases
    skip-cleanup: true
    file: dist/dynosign*.AppImage
    github-token: $GITHUB_TOKEN
    api_key: $GITHUB_TOKEN
    on:
      tags: true

  - provider: pages
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    api_key: $GITHUB_TOKEN
    local_dir: _site
    on:
      branch: master